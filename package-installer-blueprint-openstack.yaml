##################################################################################
# Package Installer Blueprint Example
##################################################################################

tosca_definitions_version: cloudify_dsl_1_0

imports:
  - http://www.getcloudify.org/spec/cloudify/3.2/types.yaml
  - http://www.getcloudify.org/spec/openstack-plugin/1.2/plugin.yaml
  - http://www.getcloudify.org/spec/diamond-plugin/1.2/plugin.yaml
  - https://raw.githubusercontent.com/kemiz/monitored-server-cfy3/master/types/monitored-server-types.yaml
#  - /Users/kemi/Documents/Development/cloudify-package-installer-plugin/plugin.yaml
  - https://raw.githubusercontent.com/kemiz/cloudify-package-installer-plugin/master/plugin.yaml

inputs:

  image:
    description: >
      Image to be used when launching agent VM's

  flavor:
    description: >
      Flavor of the agent VM's

  agent_user:
    description: >
      User for connecting to agent VM's


node_templates:

  ##################################################################################
  # Infrastructure Nodes
  ##################################################################################

  elasticsearch_host:
    type: monitoredhosts.openstack.nodes.MonitoredServer

  tomcat_host:
    type: monitoredhosts.openstack.nodes.MonitoredServer

  mongod_host:
    type: monitoredhosts.openstack.nodes.MonitoredServer

  ##################################################################################
  # Service Nodes
  ##################################################################################

  elasticsearch:
    type: cloudify.nodes.Elasticsearch
    relationships:
      - type: cloudify.relationships.contained_in
        target: elasticsearch_host

  tomcat:
    type: cloudify.nodes.TomcatServer
    relationships:
      - type: cloudify.relationships.contained_in
        target: tomcat_host

  mongod:
    type: cloudify.nodes.MongoDB
    relationships:
      - type: cloudify.relationships.contained_in
        target: mongod_host

  ##################################################################################
  # Application Nodes
  ##################################################################################

  application:
    type: cloudify.nodes.TomcatApplication
    properties:
      name: 'example_app'
      version: '1.0'
      application_binary: 'http://raw.githubusercontent.com/kemiz/example_app/example_app.war'
    relationships:
      - type: cloudify.relationships.contained_in
        target: tomcat
      - type: cloudify.relationships.connected_to
        target: elasticsearch